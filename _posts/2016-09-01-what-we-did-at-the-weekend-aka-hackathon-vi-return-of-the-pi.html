---
layout: post
status: publish
published: true
title: What we did at the weekend! (aka. Hackathon VI - Return of the Pi)
author:
  display_name: James Devine
  login: james
  email: devine.jd@gmail.com
  url: ''
author_login: james
author_email: devine.jd@gmail.com
wordpress_id: 256
wordpress_url: http://cosmicpi.org/?p=256
date: '2016-09-01 00:04:04 +0200'
date_gmt: '2016-08-31 23:04:04 +0200'
categories:
- Blog
tags:
- open hardware
- arduino due
- cosmic rays
- muons
- muon
- SiPM detector
- SiPM open source
- cosmic ray detector
- Hackathon
comments:
- id: 2327
  author: Tony Abbey
  author_email: tabbey01@gmail.com
  author_url: http://leicesterhackspace.org.uk
  date: '2016-09-02 09:08:21 +0200'
  date_gmt: '2016-09-02 08:08:21 +0200'
  content: "Great write up James,  Thanks.  You could perhaps reduce the size of the
    images -  we don't all have the benefit of multi terrabit  LANs out here in the
    Styx ;-) \r\nI would love to help with experiments,  but now I am retired from
    a university research lab,  need advice on how to get hold of a couple of the
    SIPMs and scintillator slabs at reasonable cost.  I guess you must already be
    thinking of this for the crowd funding to come. \r\nOne of your unpopulated analogue
    boards would be great as well -  can I PM you for details? \r\nTony"
- id: 2328
  author: James Devine
  author_email: devine.jd@gmail.com
  author_url: ''
  date: '2016-09-02 09:51:22 +0200'
  date_gmt: '2016-09-02 08:51:22 +0200'
  content: Thanks Tony! Images are reduced. The SiPM's can be bought direct from <a
    href="http:&#47;&#47;advansid.com&#47;products&#47;product-detail&#47;asd-rgb-nuv-3s-p"
    rel="nofollow">Advansid<&#47;a> The type is ASD-NUV-3S-P, they should be in the
    region of 35 EUR each, give or take taxes and shipping. Our current boards require
    them to be surface mounted, which is doable with an oven, but Advansid do supply
    them on carrier PCB's for an extra couple of euros, with output pins; we'll try
    to add this to our version 2.2, but for now we'll be focusing on our main PCB
    which is due to arrive on Monday. Also on the list is looking for a supplier to
    provide the boards fully assembled.
- id: 2330
  author: Tony Abbey
  author_email: tabbey01@gmail.com
  author_url: ''
  date: '2016-09-03 00:20:48 +0200'
  date_gmt: '2016-09-02 23:20:48 +0200'
  content: "Hi James, thanks for the reply - the link to Advansid doesn't get to a
    shop - only the documentation for the devices - presumably I need to email them
    for ordering if they are back from their summer holidays.  I still need some details
    on getting hold of scintillator slabs, and your current analog board. \r\n\r\nTony"
---
<p>This weekend we held the 6th Cosmic Pi team Hackathon at <a href="http:&#47;&#47;cern.ch&#47;">CERN<&#47;a>. This means that we've spent 6 whole weekends (and probably a few more!) designing, building and testing our designs for Cosmic Pi. As any experimental physicist will tell you, building hardware comes with it's fair share of disappointments along the way, but this weekend we had some successes. Here they are:</p>
<p><strong>Analogue PCB Testing<&#47;strong></p>
<p>[caption id="attachment_260" align="aligncenter" width="768"]<a href="http:&#47;&#47;cosmicpi.org&#47;wp-content&#47;uploads&#47;2016&#47;08&#47;2016-08-15-15.35.19.jpg"><img class="wp-image-260 size-large" src="http:&#47;&#47;cosmicpi.org&#47;wp-content&#47;uploads&#47;2016&#47;08&#47;2016-08-15-15.35.19-768x1024.jpg" alt="Our analogue front end PCB prototypes arrived a two weeks ago from SEEED studio." width="768" height="1024" &#47;><&#47;a> Our analogue front end PCB prototypes arrived a two weeks ago from SEEED studio.[&#47;caption]</p>
<p>We designed a new Analogue front end Printed Circuit Board a few weeks ago, had them fabricated by <a href="http:&#47;&#47;www.seeedstudio.com">SEEED<&#47;a> in China and shipped to us in Switzerland. The design comprises of a 50x50mm mezzanine card, featuring two <a href="https:&#47;&#47;en.wikipedia.org&#47;wiki&#47;Silicon_photomultiplier">Silicon Photomultipliers<&#47;a> (SiPM) - the light detecting modules in a Cosmic Pi - on one side, and a pair of low power, high bandwidth amplifiers on the other. The board is designed to be glued to a slab of scintillator (the special plastic tile that emits photons of light when Muons pass through it). The inputs to the board are three: +5V (from the <a href="https:&#47;&#47;www.arduino.cc&#47;en&#47;Main&#47;ArduinoBoardDue">Arduino DUE<&#47;a>), +Vbias (approximately 30V, which will come from our Main PCB, but for these tests we used an external 35V power supply) and Ground. The outputs are two single channel analogue signals, which are read into the Analogue to Digital Converter (ADC) on the Arduino DUE. Normally the board will plug into the top of our main PCB, sitting on top of the scintillator - but the spacings of the pin headers are set out such that it can also plug straight into an Arduino to facilitate testing.</p>
<p>[caption id="attachment_257" align="aligncenter" width="768"]<a href="http:&#47;&#47;cosmicpi.org&#47;wp-content&#47;uploads&#47;2016&#47;08&#47;2016-08-25-10.17.48.jpg"><img class="wp-image-257 size-large" src="http:&#47;&#47;cosmicpi.org&#47;wp-content&#47;uploads&#47;2016&#47;08&#47;2016-08-25-10.17.48-768x1024.jpg" alt="One plugs in to the other one to facilitate testing!" width="768" height="1024" &#47;><&#47;a> One plugs into the other one to facilitate testing![&#47;caption]</p>
<p>We tested a few different aspects of the circuits:</p>
<ol>
<li>4 V power supply - After talking with an analogue electronics expert, he recommended that we introduce a separate voltage rail with a <a href="https:&#47;&#47;en.wikipedia.org&#47;wiki&#47;Low-dropout_regulator">Low Dropout regulator<&#47;a> (LDO) to enhance noise immunity from the potentially very noisy 5V rail (which comes in from the USB plug on the Arduino). We checked this and it was within the tolerance (actually just a touch below 4V) on both the prototype PCBs.<&#47;li>
<li>SiPM Voltage and output signal - to ensure that the breakdown voltage was applied across the diode. Initially we had some problems as we couldn't get the voltage across the diode above 26 V, no matter how much we put into the Vbias pin. Initially I suspected that one of the capacitors was breaking down due to a 25V breakdown voltage, however research indicated that actually the breakdown failure mode of a capacitor is generally to short circuit, which would have given us 0 V. I changed the capacitors just in case, it didn't have any effect so I changed them back again. The actual cause was the bias resistor, inserted to limit the current in the SiPM and prevent damage. Our initial design used 100k Ohms as we'd seen high values in other people's designs. However we changed it to 40.2 Ohms and after that everything worked as expected, with almost the full Vbias appearing across the SiPM.<&#47;li>
<li>Amplifier performance - each SiPM has an analogue amplifier which uses the AD8014 SOT-32 amplifier chip (<a href="https:&#47;&#47;web.physik.rwth-aachen.de&#47;~hebbeker&#47;theses&#47;schumacher_master.pdf">we were inspired by this thesis<&#47;a>, thanks to Johannes Schumacher for replying to our email questions!), used to both stretch and amplify the very rapid signal from the SiPM into something which can be sampled using our ADC. The first test of the amplifier was the output bias voltage, which was measured to approximately 450 mV in the quiescent condition (no input signal). When a signal was applied (either by shining light on the SiPM in the presence of a Vbias, or by coupling it with the scintillator), a corresponding pulse of between 20-40 mV was seen on the signal output. This was more or less as predicted by the <a href="http:&#47;&#47;www.linear.com&#47;designtools&#47;software&#47;#LTspice">LT Spice<&#47;a> model - which is available in our <a href="http:&#47;&#47;www.ohwr.org&#47;attachments&#47;download&#47;4590&#47;CosmicPi_Analogue_Ver2point1_OHWR.zip">analogue package zip file here<&#47;a>. The SiPM input signal was slightly larger than expected (200 mV rather than 140 mV as we initially guestimated), but the timing parameters were accurate (approx 5 ns rise and a slightly longer decay). The performance of the amplifier was somewhat compromised by the presence of significant noise (100 mV peak, at 100 kHz), however we still managed to see some interesting things by carefully setting the trigger on our scope.<&#47;li><br />
<&#47;ol><br />
[caption id="attachment_258" align="aligncenter" width="497"]<a href="http:&#47;&#47;cosmicpi.org&#47;wp-content&#47;uploads&#47;2016&#47;08&#47;cosmic.jpg"><img class="size-full wp-image-258" src="http:&#47;&#47;cosmicpi.org&#47;wp-content&#47;uploads&#47;2016&#47;08&#47;cosmic.jpg" alt="These pulses were obtained by manually triggering the scope. There is a large amount of noise from the bench power supply, but it still has a good probability of being a cosmic ray due to the simultaneous triggering of both SiPMs." width="497" height="280" &#47;><&#47;a> These pulses were obtained by manually triggering the scope. There is a large amount of noise from the bench power supply, but it still has a good probability of being a cosmic ray due to the simultaneous triggering of both SiPMs.[&#47;caption]</p>
<p>We later made some modifications to two of the resistors that control the gain and pulse shaping function of the amplifier. This provides a higher peak voltage (up to a few hundred mV for our reference signal), at the expense of a shorter duration pulse (down to about 7 uS from more than 10 uS). However, given the noise performance we observed this is a trade off well worth making. We have 48 of these individual PCB's left over (unpopulated). If you are interested in getting hold of one let us know, as we are currently trying to figure out what would be the best use of them. In this version the mounting of the SiPM really needs use of a reflow oven, but we do plan to add socket connection points to a future version making it more home assembly friendly. Our next batch of these boards will be panelised to make volume production possible.</p>
<p>At this point we should also thank our follower&nbsp;<span class="gD">Philipp Foedisch for sharing his comments on our analogue design with us before we assembled it. He pointed out that the datasheet for the <a href="http:&#47;&#47;www.analog.com&#47;media&#47;en&#47;technical-documentation&#47;data-sheets&#47;AD8014.pdf">AD8014<&#47;a> specifies a minimum rail-to-rail voltage of 4.5 V (and we're driving it at 4 V) and a minimum input bias voltage of&nbsp;1.1 V to 3.9 V. Our design is slightly outside both of these parameters, however as you can see from the oscilloscope traces, it still meets our functional requirements. We are now reviewing whether to keep the 4 V rail, but we have decided to keep the input bias voltage the same (at least as a potential divider ratio based on the amplifier supply voltage). We have included a non-mounted 0 ohm resistor to bypass the 4 V LDO, however changes to the gain resistor network mean that we risk saturating if we increase the bias input voltage too much. Before assembling and testing our hardware, we&nbsp;also looked up some <4 V tolerant SOT-23 amplifiers, such as the <a href="http:&#47;&#47;www.analog.com&#47;media&#47;en&#47;technical-documentation&#47;data-sheets&#47;AD8057_8058.pdf">AD8057<&#47;a> but for the moment we will be keeping our current amplifier. Changing the amplifier might also be an option in the future to reduce the BOM cost of this PCB module.<&#47;span></p>
<p>With the scintillator and analogue board assembled and connected to an Arduino, with the Vbias pin carefully removed and connected to an external 32 V power supply, we were able to operate the system as a cosmic ray detector, by creating a software trigger with a variable threshold in the Arduino. Note that the removal of the Vbias pin is essential, as connecting a 32 V supply to the <a href="http:&#47;&#47;forum.arduino.cc&#47;index.php?topic=248137.0">Arduino's Vin<&#47;a> pin is likely to completely destroy it. This simplified detector isn't the main aim of our project, but does provide a great proof of concept for a simplified scintillator cosmic ray detector. Here is a <a href="https:&#47;&#47;www.facebook.com&#47;cosmicpi&#47;videos&#47;961554817287958&#47;">video of it in operation<&#47;a> and the code for our <a href="https:&#47;&#47;gist.github.com&#47;pingud98&#47;7872de8535718fcd7c073542786f877d">software trigger is now in a gist on github<&#47;a>.</p>
<p><strong>Scintillator<&#47;strong></p>
<p>We wrapped a pair of our <a href="http:&#47;&#47;www.eljentechnology.com&#47;index.php&#47;products&#47;plastic-scintillators&#47;ej-200-ej-204-ej-208-ej-212">EJ-200 scintillators<&#47;a> and coupled them to the SiPM's using <a href="http:&#47;&#47;go-araldite.com&#47;">Araldite<&#47;a> clear epoxy resin. One of the joints was a success, the other had to be re-done twice - it turns out that Acetone is a good solvent for epoxy and should be used with a lot of care and very sparingly when cleaning optical components before gluing! We tested one of the slabs by reading out the signal via the SiPM and amplifiers, which gave us some likely cosmic ray candidates. We also tested light injection, using the LED flash of our mobile phones, and then a more sophisticated fibre optic light injection system. These tests confirmed that the slab was well coupled to the SiPM sensors.</p>
<p>[caption id="attachment_265" align="aligncenter" width="780"]<a href="http:&#47;&#47;cosmicpi.org&#47;wp-content&#47;uploads&#47;2016&#47;08&#47;2016-08-29-01.30.39.jpg"><img class="wp-image-265 size-large" src="http:&#47;&#47;cosmicpi.org&#47;wp-content&#47;uploads&#47;2016&#47;08&#47;2016-08-29-01.30.39-1024x768.jpg" alt="A wrapped scintillator coupled to an Arduino Due with an external 32 V power supply" width="780" height="585" &#47;><&#47;a> A wrapped scintillator coupled to an Arduino Due with an external 32 V power supply[&#47;caption]</p>
<p>The light injection waveform was studied using a high speed oscilloscope, showing saturation of the SiPM at high light levels. We thought we had better do this test using a proper light injection set-up, however we had tried it earlier using a camera phone flash - and it worked. However the LED light injection system is configurable, both in terms of the intensity of light injected and the frequency and duration of the pulses, making it much better for obtaining a precise understanding of the system performance.</p>
<p>[caption id="attachment_264" align="aligncenter" width="780"]<a href="http:&#47;&#47;cosmicpi.org&#47;wp-content&#47;uploads&#47;2016&#47;08&#47;2016-08-28-22.06.26.jpg"><img class="wp-image-264 size-large" src="http:&#47;&#47;cosmicpi.org&#47;wp-content&#47;uploads&#47;2016&#47;08&#47;2016-08-28-22.06.26-1024x768.jpg" alt="2016-08-28 22.06.26" width="780" height="585" &#47;><&#47;a> High level light injection into the scintillator slab, observed at the amplifier output.[&#47;caption]</p>
<p>In response to the success of the light injection tests we have added a 2mm thick (so as to be the same height as the SiPM modules) LED to our next generation analogue PCB. This will enable us to pulse red and blue light into the scintillator and verify the coupling of production units in a non-invasive way.</p>
<p><strong>Zero Point Five Baseline<&#47;strong></p>
<p>As our regular readers will already have seen, we did a <a href="http:&#47;&#47;cosmicpi.org&#47;2016&#47;08&#47;08&#47;28-hour-zero-baseline-test-results&#47;">'zero baseline' experiment a few weeks ago<&#47;a> to demonstrate the timing performance of our system using GPS as a reference. The zero baseline is comparatively simple, as all the data can be gathered by simply logging the serial data to a single computer over USB. We decided to do another test, this time with the two systems geographically separated. This adds the complexity of using the internet to send the signals to a single common point (our server), requiring a local script on each system and another to suck in the data on the server and log it. At the moment we're doing this using Python and the UDP protocol.</p>
<p>Of course, we're no longer able to provide the same trigger signal to both systems simultaneously - as we don't have a very long cable! Therefore each system gets a trigger pulse which is regenerated from the GPS pulse per second signal with a delay of approximately 249 ms, generated by a second Arduino DUE. The exact delay of the second pulse is subject to the operation of the second Arduino's internal clock, so exhibits some drift with temperature. However, the purpose of this test is to demonstrate the overall reliability of our system when operated at two different locations, and our capacity to send back to a server, rather than to measure the temperature performance of an Arduino. This test is a prelude to our Long Baseline test which we'll be doing in the near future. It will involve a high accuracy simultaneous pulse arriving at two systems in different locations approximately 20 km apart - we are fortunate to have friends with some very long wires!</p>
<p>[caption id="attachment_225" align="aligncenter" width="1280"]<a href="http:&#47;&#47;cosmicpi.org&#47;wp-content&#47;uploads&#47;2016&#47;07&#47;zerobase.png"><img class="wp-image-225 size-full" src="http:&#47;&#47;cosmicpi.org&#47;wp-content&#47;uploads&#47;2016&#47;07&#47;zerobase.png" alt="A recap of the principles of the Zero Baseline test" width="1280" height="720" &#47;><&#47;a> A recap of the principles of the Zero Baseline test[&#47;caption]</p>
<p>Here are some <a href="http:&#47;&#47;www.ohwr.org&#47;attachments&#47;download&#47;4583&#47;zeropoint5baselineshort.csv">raw results from our zero point five baseline<&#47;a>, taken from a preliminary run lasting only a couple of hours. A 48 hour test is running as I speak, we'll make the data available as soon as we can.</p>
<p><strong>What's next?<&#47;strong></p>
<p>So far we have validated and improved our design for the analogue PCB. If you want to build your own you can get our improved version 2.1 design <a href="http:&#47;&#47;www.ohwr.org&#47;attachments&#47;download&#47;4590&#47;CosmicPi_Analogue_Ver2point1_OHWR.zip">here<&#47;a>. If you've already started building a V2, don't worry - it works fine as described here. Our next objective will be to assemble our <a href="http:&#47;&#47;www.ohwr.org&#47;attachments&#47;download&#47;4554&#47;Cosmic_Pi_Main_PCB_V2_Alpha_OHWR.zip">Main PCB V2<&#47;a>&nbsp;Alpha and test this, however we're waiting for our prototype PCB's to arrive from China and a few other longer lead components (GPS modules and the <a href="https:&#47;&#47;www.maximintegrated.com&#47;en&#47;products&#47;power&#47;switching-regulators&#47;MAX1932.html">MAX1932<&#47;a> chip we're using to generate Vbias).</p>
<p>When we have all the components and access to the machines for assembly, we'll have yet another hackathon to test the many functions of this board (GPS, Timing, Triggering, Humidity, Temperature, Acceleration, Magnetic Field sensing, Bias voltage generation, physical form factor and fitting into our housing, connections to the Arduino and anything else we can think of). If everything goes well then we'll start production of our first units for the <a href="http:&#47;&#47;beamline-for-schools.web.cern.ch&#47;">CERN Beamlines for Schools<&#47;a> competition runner-up prizes, and if we have any major issues we will revise our Main PCB and repeat when the new boards arrive. Until then we can be confident that the detection hardware is on a solid footing and catch up on some sleep!</p>
<p>[caption id="attachment_263" align="aligncenter" width="768"]<a href="http:&#47;&#47;cosmicpi.org&#47;wp-content&#47;uploads&#47;2016&#47;08&#47;2016-08-28-21.57.02.jpg"><img class="wp-image-263 size-large" src="http:&#47;&#47;cosmicpi.org&#47;wp-content&#47;uploads&#47;2016&#47;08&#47;2016-08-28-21.57.02-768x1024.jpg" alt="Probing the analogue PCB for signals from the amplifiers." width="768" height="1024" &#47;><&#47;a> Probing the analogue PCB for signals from the amplifiers.[&#47;caption]</p>
